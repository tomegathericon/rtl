#!/bin/zsh
set -x

cidr_vpc=6.255.255.0/24
cidr_subnet=$cidr_vpc
aws_profile=kapoor.neelima@outlook.com

vpc_id=$(aws ec2 create-vpc  --cidr-block $cidr_vpc --profile $aws_profile | jq '.Vpc.VpcId' | sed 's/"//g')

subnet_id=$(aws ec2 create-subnet --vpc-id $vpc_id --cidr-block $cidr_subnet --profile $aws_profile | jq '.Subnet.SubnetId' | sed 's/"//g')

ig_id=$(aws ec2 create-internet-gateway --profile $aws_profile | jq '.InternetGateway.InternetGatewayId' | sed 's/"//g')

aws ec2 attach-internet-gateway --internet-gateway-id $ig_id --vpc-id $vpc_id --profile $aws_profile

rt_id=$(aws ec2 create-route-table --vpc-id $vpc_id --profile $aws_profile | jq '.RouteTable.RouteTableId' | sed 's/"//g')

aws ec2 associate-route-table --subnet-id $subnet_id --route-table-id $rt_id --profile $aws_profile

sed -i s{rt_id{$rt_id{g skeletons/create_route.skeleton
sed -i s{ig_id{$ig_id{g skeletons/create_route.skeleton
aws ec2 create-route --cli-input-json file://skeletons/create_route.skeleton --profile $aws_profile
